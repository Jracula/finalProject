<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="directMessage">

	<insert id="insertDm" parameterType="dm">
		insert into member_dm values(
			member_dm_seq.nextval,
			#{dmSender},
			#{dmReceiver},
			#{dmContent},
			sysdate,
			0,
			0,
			0
		)
	</insert>

	<select id="selectAllDm" resultType="dm" parameterType="dm">
			select
			    rownum as rnum, 
			    dm_sender as dmSender,
			    s.member_name as dmSenderName,
			    dm_receiver as dmReceiver,
			    r.member_name as dmReceiverName,
			    dm_content as dmContent,
			    to_char(dm_date,'yyyy-mm-dd') as dmDate,
			    to_char(dm_date,'yyyy-mm-dd hh24:mi') as dmDateHour,
			    dm_readchk as dmReadChk
			from
			    member_dm d  
			    join member_tbl s on (d.dm_sender = s.member_id)
			    join member_tbl r on (d.dm_receiver = r.member_id)
		<if test="dmReceiver != null">
			where
			    dm_receiver = #{dmReceiver}
		</if>
		<if test="dmSender != null">
			where
			    dm_sender = #{dmSender}
		</if>
			order by 1 desc
	</select>
	
	
	
	
	<select id="selectDmCount" parameterType="string" resultType="_int">
		select
			count(*)
		from
			member_dm
		where
			dm_receiver=#{_parameter} and dm_readchk=0 
	</select>
	

</mapper>
