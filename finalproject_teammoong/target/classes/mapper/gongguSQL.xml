<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN
" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="gonggu">
	<select id="selectGongguList" parameterType="_int" resultType="gai">
		SELECT
			MEMBER_PATH AS memberPath,
			MEMBER_ID AS memberId,
			GONGGU_NO AS gongguNo,
			GONGGU_NUMBER AS gongguNumber,
			COUNT_NUMBER AS countNumber
		FROM PRODUCT_TBL
		INNER JOIN GONGGU_TBL USING(PRODUCT_NO)
		LEFT JOIN MEMBER_TBL USING(MEMBER_NO)
		LEFT JOIN DETAIL_GONGGU_TBL USING(GONGGU_NO)
		WHERE PRODUCT_NO = #{_parameter}
	</select>
	
	<select id="selectGongguPayCount" parameterType="_int" resultType="_int">
		SELECT COUNT(*)
		FROM DETAIL_GONGGU_TBL A
        INNER JOIN GONGGU_PAY_TBL B ON A.DETAIL_GONGGU_NO = B.DETAIL_GONGGU_NO
		WHERE B.GONGGU_PAY_STATUS = '1'
        AND A.GONGGU_NO = #{gongguNo}
	</select>
	
	<insert id="insertGonggu" parameterType="g">
		INSERT INTO GONGGU_TBL VALUES(GONGGU_SEQ.NEXTVAL,
		#{productNo},
		#{memberNo})
	</insert>
	
	<select id="selectInsertGonggu" resultType="g">
		SELECT 
			GONGGU_NO AS gongguNo,
			MEMBER_NO AS memberNo 
		FROM GONGGU_TBL
		WHERE GONGGU_NO IN(SELECT MAX(GONGGU_NO) FROM GONGGU_TBL)
	</select>
	
	<insert id="insertDetailGonggu" parameterType="g">
		INSERT INTO DETAIL_GONGGU_TBL VALUES(DETAIL_GONGGU_SEQ.NEXTVAL,
		#{gongguNo},
		#{memberNo},
		1)
	</insert>
	
	<select id="selectCountNumber" resultType="gai">
		SELECT SUM(COUNT_NUMBER) AS countNumber FROM DETAIL_GONGGU_TBL
	</select>
</mapper>
