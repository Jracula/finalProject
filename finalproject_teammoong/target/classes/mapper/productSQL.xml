<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN
" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="product">

	<insert id="insertProduct" parameterType="p">
		insert into product_tbl values
		(product_seq.nextval,
		#{dCategoryNo},
		#{productName},
		#{productEa},
		#{productPrice},
		#{productStatus},
		#{productCost},
		#{gongguNumber},
		#{productContent},
		#{productDiscount})
	</insert>
	
	<select id="selectProductNo" resultType="_int">
		select max(product_no) from product_tbl
	</select>

	<insert id="insertFile">
		insert into product_img values(product_img_seq.nextval,
		#{productNo},
		#{filepath})
	</insert>
	
	<select id="selectProductByProductNo" parameterType="_int" resultType="p">
		SELECT 
			PRODUCT_NO AS productNo,
			D_CATEGORY_NO AS dCategoryNo,
			PRODUCT_NAME AS productName,
			PRODUCT_EA AS productEa,
			PRODUCT_PRICE AS productPrice,
			PRODUCT_STATUS AS productStatus,
			PRODUCT_COST AS productCost,
			GONGGU_NUMBER AS  gongguNumber,
			PRODUCT_CONTENT AS productContnet,
			PRODUCT_DISCOUNT AS productDiscount
		FROM PRODUCT_TBL 
		WHERE PRODUCT_NO = #{_parameter}
	</select>
	
	<select id="selectProductImg" parameterType="_int" resultType="pf">
		SELECT
			P_IMG_NO AS pImgNo,
			PRODUCT_NO AS productNo,
			FILEPATH AS filepath
		FROM PRODUCT_IMG
		WHERE PRODUCT_NO = #{_parameter}
	</select>
	
	<select id="selectProductList" resultType="p">
		SELECT 
			PRODUCT_NO AS productNo,
			D_CATEGORY_NO AS dCategoryNo,
			PRODUCT_NAME AS productName,
			PRODUCT_EA AS productEa,
			PRODUCT_PRICE AS productPrice,
			PRODUCT_STATUS AS productStatus,
			PRODUCT_COST AS productCost,
			GONGGU_NUMBER AS  gongguNumber,
			PRODUCT_CONTENT AS productContent,
			PRODUCT_DISCOUNT AS productDiscount
		FROM PRODUCT_TBL 
	</select>
	
	<select id="selectInfiniteScrollProductList" parameterType="map" resultType="p">
		SELECT * FROM
		(SELECT ROWNUM AS RNUM, P.* FROM
		(SELECT 
				PRODUCT_NO AS productNo,
				D_CATEGORY_NO AS dCategoryNo,
				PRODUCT_NAME AS productName,
				PRODUCT_EA AS productEa,
				PRODUCT_PRICE AS productPrice,
				PRODUCT_STATUS AS productStatus,
				PRODUCT_COST AS productCost,
				GONGGU_NUMBER AS  gongguNumber,
				PRODUCT_CONTENT AS productContent,
				PRODUCT_DISCOUNT AS productDiscount,
				(SELECT FILEPATH FROM PRODUCT_IMG WHERE P_IMG_NO=(SELECT MIN(P_IMG_NO) FROM PRODUCT_IMG  WHERE PRODUCT_NO=PRODUCT_TBL.PRODUCT_NO))  AS thumbnail
		FROM PRODUCT_TBL WHERE D_CATEGORY_NO = #{sCategoryNo} ORDER BY 1 DESC) P)
		WHERE RNUM BETWEEN #{start} AND #{end}
		
	</select>	
	<select id="selectProductFilelist" parameterType="_int" resultType="pf">
		SELECT
			P_IMG_NO AS pImgNo,
			PRODUCT_NO AS productNo,
			FILEPATH AS filepath
		FROM PRODUCT_IMG
		WHERE PRODUCT_NO = #{_parameter}
	</select>
</mapper>
